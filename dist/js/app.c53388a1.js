(()=>{"use strict";var e={980:(e,a,l)=>{var r=l(751),t=l(641),s=l(33);const i=l.p+"img/fu.94d7c1c3.png",n=l.p+"img/music.b21a476b.png",o=l.p+"media/music.20f36300.mp3";var u=l(953),c=l(809),p=l(694),v=l.n(p),f=l(249),d=l(224);const m={class:"image-cropper"},g={class:"cropper-container"},b={class:"cropper-buttons"},k=(0,t.pM)({__name:"ImageCropper",props:{visible:{type:Boolean},imageUrl:{}},emits:["update:visible","confirm"],setup(e,{emit:a}){const l=a,r=(0,u.KR)(),s=()=>{l("update:visible",!1)},i=()=>{r.value.getCropData((e=>{l("confirm",e),l("update:visible",!1)}))},n=e=>{};return(e,a)=>{const o=(0,t.g2)("van-button"),c=(0,t.g2)("van-popup");return(0,t.uX)(),(0,t.CE)("div",m,[(0,t.bF)(c,{show:e.visible,"onUpdate:show":a[0]||(a[0]=e=>l("update:visible",e)),position:"bottom",style:{height:"70%"}},{default:(0,t.k6)((()=>[(0,t.Lk)("div",g,[(0,t.bF)((0,u.R1)(d.Ay),{ref_key:"cropperRef",ref:r,img:e.imageUrl,outputSize:1,outputType:"png",info:!0,full:!0,canMove:!0,canMoveBox:!0,original:!1,autoCrop:!0,fixed:!0,fixedNumber:[1,1],centerBox:!0,onRealTime:n},null,8,["img"]),(0,t.Lk)("div",b,[(0,t.bF)(o,{type:"default",onClick:s},{default:(0,t.k6)((()=>a[1]||(a[1]=[(0,t.eW)("取消")]))),_:1}),(0,t.bF)(o,{type:"primary",onClick:i},{default:(0,t.k6)((()=>a[2]||(a[2]=[(0,t.eW)("确定")]))),_:1})])])])),_:1},8,["show"])])}}});var y=l(262);const h=(0,y.A)(k,[["__scopeId","data-v-9509fcea"]]),C=h,_={class:"avatar-maker"},L={class:"decoration"},R={class:"main-content"},w={class:"preview-area"},x=["src"],O=["src"],F={key:2,class:"placeholder"},K=["src"],E={class:"action-buttons"},X={class:"frame-selector"},U={class:"frames-grid"},j=["onClick"],I=["src"],M={class:"bottom-buttons"},W=(0,t.pM)({__name:"AvatarMaker",setup(e){const a=(0,u.KR)([{url:l(491)},{url:l(0)},{url:l(713)},{url:l(622)},{url:l(615)},{url:l(532)}]),r=(0,u.KR)(0),p=(0,u.KR)(""),d=(0,u.KR)(""),m=(0,u.KR)(!1),g=(0,u.KR)(""),b=(0,u.KR)(),k=(0,u.KR)(),y=(0,u.KR)(),h=(0,u.KR)(!1),W=async()=>{try{const e=await wx.getUserInfo();p.value=e.avatarUrl}catch(e){(0,c.y8)("获取头像失败")}},A=()=>{b.value?.click()},B=e=>{const a=e.target.files?.[0];a&&(g.value=URL.createObjectURL(a),m.value=!0)},T=e=>{p.value=e,d.value=""},z=e=>{r.value=e,d.value=""},P=async()=>{if(k.value)try{const e=await v()(k.value,{useCORS:!0,backgroundColor:null}),a=await new Promise((a=>{e.toBlob((e=>{a(e)}),"image/png")}));(0,f.saveAs)(a,"新年头像.png"),(0,c.y8)("头像已保存")}catch(e){(0,c.y8)("生成失败，请重试")}},D=()=>{y.value&&(y.value.paused?(y.value.play(),h.value=!0):(y.value.pause(),h.value=!1))},S=()=>{history.back()};return(0,t.sV)((()=>{y.value?.play().then((()=>{h.value=!0})).catch((()=>{h.value=!1}))})),(0,t.hi)((()=>{y.value?.pause()})),(e,l)=>{const u=(0,t.g2)("van-icon"),c=(0,t.g2)("van-button");return(0,t.uX)(),(0,t.CE)("div",_,[(0,t.Lk)("div",L,[l[1]||(l[1]=(0,t.Lk)("img",{src:i,class:"fu-icon"},null,-1)),(0,t.Lk)("div",{class:"music-control",onClick:D},[(0,t.Lk)("img",{src:n,class:(0,s.C4)({rotating:h.value})},null,2)])]),(0,t.Lk)("div",R,[(0,t.Lk)("div",w,[(0,t.Lk)("div",{class:"avatar-frame",ref_key:"avatarRef",ref:k},[d.value?((0,t.uX)(),(0,t.CE)("img",{key:0,src:d.value,class:"merged-avatar"},null,8,x)):p.value?((0,t.uX)(),(0,t.CE)("img",{key:1,src:p.value,class:"user-avatar"},null,8,O)):((0,t.uX)(),(0,t.CE)("div",F,[(0,t.bF)(u,{name:"photo",size:"40"}),l[2]||(l[2]=(0,t.Lk)("p",null,"请选择头像",-1))])),p.value?((0,t.uX)(),(0,t.CE)("img",{key:3,src:a.value[r.value].url,class:"frame-overlay"},null,8,K)):(0,t.Q3)("",!0)],512)]),(0,t.Lk)("div",E,[(0,t.bF)(c,{class:"action-btn",onClick:W},{default:(0,t.k6)((()=>l[3]||(l[3]=[(0,t.eW)("使用当前头像")]))),_:1}),(0,t.bF)(c,{class:"action-btn",onClick:A},{default:(0,t.k6)((()=>l[4]||(l[4]=[(0,t.eW)("上传照片或拍照")]))),_:1})]),(0,t.Lk)("div",X,[l[5]||(l[5]=(0,t.Lk)("div",{class:"title"},"选择你的头像框",-1)),(0,t.Lk)("div",U,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(a.value,((e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:a,class:(0,s.C4)(["frame-item",{active:r.value===a}]),onClick:e=>z(a)},[(0,t.Lk)("img",{src:e.url},null,8,I)],10,j)))),128))])]),(0,t.Lk)("div",M,[(0,t.bF)(c,{class:"bottom-btn",onClick:S},{default:(0,t.k6)((()=>l[6]||(l[6]=[(0,t.eW)("返回")]))),_:1}),(0,t.bF)(c,{class:"bottom-btn",type:"primary",onClick:P,disabled:!p.value},{default:(0,t.k6)((()=>l[7]||(l[7]=[(0,t.eW)(" 生成新头像 ")]))),_:1},8,["disabled"])])]),(0,t.Lk)("input",{type:"file",ref_key:"fileInput",ref:b,style:{display:"none"},accept:"image/*",onChange:B},null,544),(0,t.bF)(C,{visible:m.value,"onUpdate:visible":l[0]||(l[0]=e=>m.value=e),"image-url":g.value,onConfirm:T},null,8,["visible","image-url"]),(0,t.Lk)("audio",{ref_key:"audioRef",ref:y,loop:""},l[8]||(l[8]=[(0,t.Lk)("source",{src:o,type:"audio/mpeg"},null,-1)]),512)])}}}),A=(0,y.A)(W,[["__scopeId","data-v-25ad3802"]]),B=A,T=(0,t.pM)({__name:"App",setup(e){return(e,a)=>((0,t.uX)(),(0,t.Wv)(B))}}),z=T,P=z;var D=l(88),S=l(750),N=l(626);l(979);const Q=(0,r.Ef)(P);Q.use(D.$n).use(S.In).use(c.y8).use(N.zD),Q.mount("#app")},491:(e,a,l)=>{e.exports=l.p+"img/frame1.541cba59.png"},0:(e,a,l)=>{e.exports=l.p+"img/frame2.0399396c.png"},713:(e,a,l)=>{e.exports=l.p+"img/frame3.4c0f5d26.png"},622:(e,a,l)=>{e.exports=l.p+"img/frame4.451a5c43.png"},615:(e,a,l)=>{e.exports=l.p+"img/frame5.3cb18f3a.png"},532:(e,a,l)=>{e.exports=l.p+"img/frame6.ad0451c4.png"}},a={};function l(r){var t=a[r];if(void 0!==t)return t.exports;var s=a[r]={exports:{}};return e[r].call(s.exports,s,s.exports,l),s.exports}l.m=e,(()=>{var e=[];l.O=(a,r,t,s)=>{if(!r){var i=1/0;for(c=0;c<e.length;c++){for(var[r,t,s]=e[c],n=!0,o=0;o<r.length;o++)(!1&s||i>=s)&&Object.keys(l.O).every((e=>l.O[e](r[o])))?r.splice(o--,1):(n=!1,s<i&&(i=s));if(n){e.splice(c--,1);var u=t();void 0!==u&&(a=u)}}return a}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[r,t,s]}})(),(()=>{l.n=e=>{var a=e&&e.__esModule?()=>e["default"]:()=>e;return l.d(a,{a}),a}})(),(()=>{l.d=(e,a)=>{for(var r in a)l.o(a,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:a[r]})}})(),(()=>{l.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{l.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a)})(),(()=>{l.p="/"})(),(()=>{var e={524:0};l.O.j=a=>0===e[a];var a=(a,r)=>{var t,s,[i,n,o]=r,u=0;if(i.some((a=>0!==e[a]))){for(t in n)l.o(n,t)&&(l.m[t]=n[t]);if(o)var c=o(l)}for(a&&a(r);u<i.length;u++)s=i[u],l.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return l.O(c)},r=self["webpackChunk"]=self["webpackChunk"]||[];r.forEach(a.bind(null,0)),r.push=a.bind(null,r.push.bind(r))})();var r=l.O(void 0,[504],(()=>l(980)));r=l.O(r)})();
//# sourceMappingURL=app.c53388a1.js.map